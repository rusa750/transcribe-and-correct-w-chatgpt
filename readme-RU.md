# Пайплайн для транскрипции аудио с постобработкой через GPT

Этот проект представляет собой автоматизированный пайплайн для:
- Конвертации видео в аудио (.m4a)
- Транскрипции аудио с использованием OpenAI Whisper API
- Преобразования файлов .vtt в обычные .txt
- Постобработки текста через ChatGPT для исправления грамматики и семантики

---

## Структура проекта

```
project-root/
├── audio/                 # Создаётся автоматически — содержит извлечённые аудиофайлы
├── video/                 # Входные видеофайлы
├── transcriptions/        # Выходные каталоги с транскрипциями и .txt-файлами
├── working/               # Временные WAV-сегменты для Whisper API
├── .env                   # Api keys
├── main.py                # Основной скрипт запуска
├── transcribe.py          # Модуль транскрипции с нарезкой сегментов
├── convert_video_to_audio.py
├── convert_vtt_to_txt.py
├── after_proccess.py
```

---

## Требования

Установите необходимые зависимости:

```bash
pip install -r requirements.txt
```

Содержимое `requirements.txt`:

```
openai
pydub
python-dotenv
```

Также необходимо установить [ffmpeg](https://ffmpeg.org/download.html) в систему для работы `pydub`.

---

## Настройка API-ключа

Создайте файл `.env` в корне проекта со следующим содержимым:

```
OPENAI_API_KEY=sk-...
```

---

## Использование

Запустите весь пайплайн командой:

```bash
python main.py
```

`main.py` выполняет следующие шаги:

1. Конвертирует все видеофайлы из папки `video/` в формат `.m4a` в папке `audio/`
2. Транскрибирует все поддерживаемые аудиофайлы с помощью Whisper API. Если размер аудио превышает 25 МБ, оно разбивается на сегменты
3. Преобразует все файлы `.vtt` в очищенные `.txt`
4. Выполняет постобработку всех `.txt` для улучшения грамматики и выделения упоминаний ключевых продуктов

---

## Поддерживаемые форматы

Видео:
- .mp4, .mov, .avi, .mkv, .webm

Аудио:
- .wav, .mp3, .ogg, .flac, .m4a, .aac

---

## Конфигурация

Вы можете задать список отслеживаемых продуктов в скрипте `main.py` следующим образом:

```python
products_to_watch = ["T8 FEEL", "MOBIO+", "T8 BLEND", "NASH Омега-3", "Vilavi", ...]
afterprocess_transcription(txt_folder="./transcriptions", product_list=products_to_watch)
```
